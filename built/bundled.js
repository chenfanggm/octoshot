(function(d,e){"object"===typeof exports?module.exports=e(global):"function"===typeof define&&define.amd?define([],function(){return e(d)}):e(d)})(this,function(d){function e(a){return p=a}function f(){return p="undefined"!==typeof Float32Array?Float32Array:Array}var g={};if("undefined"!=typeof Float32Array){var n=new Float32Array(1),y=new Int32Array(n.buffer);g.invsqrt=function(a){n[0]=a;y[0]=1597463007-(y[0]>>1);var b=n[0];return b*(1.5-0.5*a*b*b)}}else g.invsqrt=function(a){return 1/Math.sqrt(a)};
var p=null;f();var l={create:function(a){var b=new p(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},createFrom:function(a,b,c){var i=new p(3);i[0]=a;i[1]=b;i[2]=c;return i},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},subtract:function(a,
b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],i=a[1],B=a[2],d=Math.sqrt(c*
c+i*i+B*B);if(!d)return b[0]=0,b[1]=0,b[2]=0,b;if(1===d)return b[0]=c,b[1]=i,b[2]=B,b;d=1/d;b[0]=c*d;b[1]=i*d;b[2]=B*d;return b},cross:function(a,b,c){c||(c=a);var i=a[0],B=a[1],a=a[2],d=b[0],j=b[1],b=b[2];c[0]=B*b-a*j;c[1]=a*d-i*b;c[2]=i*j-B*d;return c},length:function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)},squaredLength:function(a){var b=a[0],c=a[1],a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var i=a[0]-
b[0],B=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(i*i+B*B+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=i*b;c[1]=B*b;c[2]=a*b;return c},lerp:function(a,b,c,i){i||(i=a);i[0]=a[0]+c*(b[0]-a[0]);i[1]=a[1]+c*(b[1]-a[1]);i[2]=a[2]+c*(b[2]-a[2]);return i},dist:function(a,b){var c=b[0]-a[0],i=b[1]-a[1],B=b[2]-a[2];return Math.sqrt(c*c+i*i+B*B)}},r=null,m=new p(4);l.unproject=function(a,b,c,i,B){B||(B=a);r||(r=q.create());var d=r;m[0]=2*(a[0]-i[0])/i[2]-1;m[1]=2*(a[1]-i[1])/i[3]-1;m[2]=2*a[2]-1;m[3]=1;q.multiply(c,
b,d);if(!q.inverse(d))return null;q.multiplyVec4(d,m);if(0===m[3])return null;B[0]=m[0]/m[3];B[1]=m[1]/m[3];B[2]=m[2]/m[3];return B};var G=l.createFrom(1,0,0),v=l.createFrom(0,1,0),x=l.createFrom(0,0,1),u=l.create();l.rotationTo=function(a,b,c){c||(c=k.create());var i=l.dot(a,b);if(1<=i)k.set(E,c);else if(-0.999999>i)l.cross(G,a,u),1E-6>l.length(u)&&l.cross(v,a,u),1E-6>l.length(u)&&l.cross(x,a,u),l.normalize(u),k.fromAngleAxis(Math.PI,u,c);else{var i=Math.sqrt(2*(1+i)),B=1/i;l.cross(a,b,u);c[0]=u[0]*
B;c[1]=u[1]*B;c[2]=u[2]*B;c[3]=0.5*i;k.normalize(c)}1<c[3]?c[3]=1:-1>c[3]&&(c[3]=-1);return c};l.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var s={create:function(a){var b=new p(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},createFrom:function(a,b,c,i,B,d,j,e,f){var z=new p(9);z[0]=a;z[1]=b;z[2]=c;z[3]=i;z[4]=B;z[5]=d;z[6]=j;z[7]=e;z[8]=f;return z},determinant:function(a){var b=
a[3],c=a[4],i=a[5],B=a[6],d=a[7],j=a[8];return a[0]*(j*c-i*d)+a[1]*(-j*b+i*B)+a[2]*(d*b-c*B)},inverse:function(a,b){var c=a[0],i=a[1],B=a[2],d=a[3],j=a[4],e=a[5],f=a[6],z=a[7],J=a[8],l=J*j-e*z,g=-J*d+e*f,k=z*d-j*f,H=c*l+i*g+B*k;if(!H)return null;H=1/H;b||(b=s.create());b[0]=l*H;b[1]=(-J*i+B*z)*H;b[2]=(e*i-B*j)*H;b[3]=g*H;b[4]=(J*c-B*f)*H;b[5]=(-e*c+B*d)*H;b[6]=k*H;b[7]=(-z*c+i*f)*H;b[8]=(j*c-i*d)*H;return b},multiply:function(a,b,c){c||(c=a);var i=a[0],B=a[1],d=a[2],j=a[3],e=a[4],f=a[5],z=a[6],J=
a[7],a=a[8],l=b[0],g=b[1],k=b[2],H=b[3],p=b[4],r=b[5],q=b[6],m=b[7],b=b[8];c[0]=l*i+g*j+k*z;c[1]=l*B+g*e+k*J;c[2]=l*d+g*f+k*a;c[3]=H*i+p*j+r*z;c[4]=H*B+p*e+r*J;c[5]=H*d+p*f+r*a;c[6]=q*i+m*j+b*z;c[7]=q*B+m*e+b*J;c[8]=q*d+m*f+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var i=b[0],b=b[1];c[0]=i*a[0]+b*a[3]+a[6];c[1]=i*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var i=b[0],d=b[1],b=b[2];c[0]=i*a[0]+d*a[3]+b*a[6];c[1]=i*a[1]+d*a[4]+b*a[7];c[2]=i*a[2]+d*a[5]+b*a[8];return c},
set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])},identity:function(a){a||(a=s.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,
b){if(!b||a===b){var c=a[1],i=a[2],d=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=i;a[7]=d;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=q.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+
a[8]+"]"}},q={create:function(a){var b=new p(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},createFrom:function(a,b,c,i,d,D,j,e,f,z,l,g,k,r,H,q){var m=new p(16);m[0]=a;m[1]=b;m[2]=c;m[3]=i;m[4]=d;m[5]=D;m[6]=j;m[7]=e;m[8]=f;m[9]=z;m[10]=l;m[11]=g;m[12]=k;m[13]=r;m[14]=H;m[15]=q;return m},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];
b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])&&1E-6>Math.abs(a[4]-b[4])&&1E-6>Math.abs(a[5]-b[5])&&1E-6>Math.abs(a[6]-b[6])&&1E-6>Math.abs(a[7]-b[7])&&1E-6>Math.abs(a[8]-b[8])&&1E-6>Math.abs(a[9]-b[9])&&1E-6>Math.abs(a[10]-b[10])&&1E-6>Math.abs(a[11]-b[11])&&1E-6>Math.abs(a[12]-
b[12])&&1E-6>Math.abs(a[13]-b[13])&&1E-6>Math.abs(a[14]-b[14])&&1E-6>Math.abs(a[15]-b[15])},identity:function(a){a||(a=q.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1],i=a[2],d=a[3],D=a[6],j=a[7],e=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=i;a[9]=D;a[11]=a[14];a[12]=d;a[13]=j;a[14]=e;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];
b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],i=a[2],d=a[3],D=a[4],j=a[5],e=a[6],f=a[7],z=a[8],l=a[9],g=a[10],k=a[11],m=a[12],r=a[13],q=a[14],a=a[15];return m*l*e*d-z*r*e*d-m*j*g*d+D*r*g*d+z*j*q*d-D*l*q*d-m*l*i*f+z*r*i*f+m*c*g*f-b*r*g*f-z*c*q*f+b*l*q*f+m*j*i*k-D*r*i*k-m*c*e*k+b*r*e*k+D*c*q*k-b*j*q*k-z*j*i*a+D*l*i*a+z*c*e*a-b*l*e*a-D*c*g*a+b*j*g*a},inverse:function(a,
b){b||(b=a);var c=a[0],i=a[1],d=a[2],D=a[3],j=a[4],e=a[5],f=a[6],z=a[7],l=a[8],g=a[9],k=a[10],m=a[11],r=a[12],q=a[13],p=a[14],u=a[15],x=c*e-i*j,v=c*f-d*j,n=c*z-D*j,s=i*f-d*e,t=i*z-D*e,C=d*z-D*f,G=l*q-g*r,A=l*p-k*r,E=l*u-m*r,y=g*p-k*q,F=g*u-m*q,N=k*u-m*p,I=x*N-v*F+n*y+s*E-t*A+C*G;if(!I)return null;I=1/I;b[0]=(e*N-f*F+z*y)*I;b[1]=(-i*N+d*F-D*y)*I;b[2]=(q*C-p*t+u*s)*I;b[3]=(-g*C+k*t-m*s)*I;b[4]=(-j*N+f*E-z*A)*I;b[5]=(c*N-d*E+D*A)*I;b[6]=(-r*C+p*n-u*v)*I;b[7]=(l*C-k*n+m*v)*I;b[8]=(j*F-e*E+z*G)*I;b[9]=
(-c*F+i*E-D*G)*I;b[10]=(r*t-q*n+u*x)*I;b[11]=(-l*t+g*n-m*x)*I;b[12]=(-j*y+e*A-f*G)*I;b[13]=(c*y-i*A+d*G)*I;b[14]=(-r*s+q*v-p*x)*I;b[15]=(l*s-g*v+k*x)*I;return b},toRotationMat:function(a,b){b||(b=q.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=s.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];
return b},toInverseMat3:function(a,b){var c=a[0],i=a[1],d=a[2],D=a[4],j=a[5],e=a[6],f=a[8],z=a[9],l=a[10],g=l*j-e*z,k=-l*D+e*f,m=z*D-j*f,r=c*g+i*k+d*m;if(!r)return null;r=1/r;b||(b=s.create());b[0]=g*r;b[1]=(-l*i+d*z)*r;b[2]=(e*i-d*j)*r;b[3]=k*r;b[4]=(l*c-d*f)*r;b[5]=(-e*c+d*D)*r;b[6]=m*r;b[7]=(-z*c+i*f)*r;b[8]=(j*c-i*D)*r;return b},multiply:function(a,b,c){c||(c=a);var i=a[0],d=a[1],e=a[2],j=a[3],f=a[4],l=a[5],z=a[6],g=a[7],k=a[8],m=a[9],r=a[10],q=a[11],p=a[12],u=a[13],x=a[14],a=a[15],v=b[0],n=b[1],
s=b[2],t=b[3];c[0]=v*i+n*f+s*k+t*p;c[1]=v*d+n*l+s*m+t*u;c[2]=v*e+n*z+s*r+t*x;c[3]=v*j+n*g+s*q+t*a;v=b[4];n=b[5];s=b[6];t=b[7];c[4]=v*i+n*f+s*k+t*p;c[5]=v*d+n*l+s*m+t*u;c[6]=v*e+n*z+s*r+t*x;c[7]=v*j+n*g+s*q+t*a;v=b[8];n=b[9];s=b[10];t=b[11];c[8]=v*i+n*f+s*k+t*p;c[9]=v*d+n*l+s*m+t*u;c[10]=v*e+n*z+s*r+t*x;c[11]=v*j+n*g+s*q+t*a;v=b[12];n=b[13];s=b[14];t=b[15];c[12]=v*i+n*f+s*k+t*p;c[13]=v*d+n*l+s*m+t*u;c[14]=v*e+n*z+s*r+t*x;c[15]=v*j+n*g+s*q+t*a;return c},multiplyVec3:function(a,b,c){c||(c=b);var i=b[0],
d=b[1],b=b[2];c[0]=a[0]*i+a[4]*d+a[8]*b+a[12];c[1]=a[1]*i+a[5]*d+a[9]*b+a[13];c[2]=a[2]*i+a[6]*d+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var i=b[0],d=b[1],e=b[2],b=b[3];c[0]=a[0]*i+a[4]*d+a[8]*e+a[12]*b;c[1]=a[1]*i+a[5]*d+a[9]*e+a[13]*b;c[2]=a[2]*i+a[6]*d+a[10]*e+a[14]*b;c[3]=a[3]*i+a[7]*d+a[11]*e+a[15]*b;return c},translate:function(a,b,c){var i=b[0],d=b[1],b=b[2],e,j,f,l,g,k,m,r,q,v,n,p;if(!c||a===c)return a[12]=a[0]*i+a[4]*d+a[8]*b+a[12],a[13]=a[1]*i+a[5]*d+a[9]*b+a[13],a[14]=
a[2]*i+a[6]*d+a[10]*b+a[14],a[15]=a[3]*i+a[7]*d+a[11]*b+a[15],a;e=a[0];j=a[1];f=a[2];l=a[3];g=a[4];k=a[5];m=a[6];r=a[7];q=a[8];v=a[9];n=a[10];p=a[11];c[0]=e;c[1]=j;c[2]=f;c[3]=l;c[4]=g;c[5]=k;c[6]=m;c[7]=r;c[8]=q;c[9]=v;c[10]=n;c[11]=p;c[12]=e*i+g*d+q*b+a[12];c[13]=j*i+k*d+v*b+a[13];c[14]=f*i+m*d+n*b+a[14];c[15]=l*i+r*d+p*b+a[15];return c},scale:function(a,b,c){var i=b[0],d=b[1],b=b[2];if(!c||a===c)return a[0]*=i,a[1]*=i,a[2]*=i,a[3]*=i,a[4]*=d,a[5]*=d,a[6]*=d,a[7]*=d,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=
b,a;c[0]=a[0]*i;c[1]=a[1]*i;c[2]=a[2]*i;c[3]=a[3]*i;c[4]=a[4]*d;c[5]=a[5]*d;c[6]=a[6]*d;c[7]=a[7]*d;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},rotate:function(a,b,c,i){var d=c[0],e=c[1],c=c[2],j=Math.sqrt(d*d+e*e+c*c),f,l,g,k,m,r,q,v,n,p,s,t,u,x,C,G,A,E,y,F;if(!j)return null;1!==j&&(j=1/j,d*=j,e*=j,c*=j);f=Math.sin(b);l=Math.cos(b);g=1-l;b=a[0];j=a[1];k=a[2];m=a[3];r=a[4];q=a[5];v=a[6];n=a[7];p=a[8];s=a[9];t=a[10];u=a[11];x=d*d*g+
l;C=e*d*g+c*f;G=c*d*g-e*f;A=d*e*g-c*f;E=e*e*g+l;y=c*e*g+d*f;F=d*c*g+e*f;d=e*c*g-d*f;e=c*c*g+l;i?a!==i&&(i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15]):i=a;i[0]=b*x+r*C+p*G;i[1]=j*x+q*C+s*G;i[2]=k*x+v*C+t*G;i[3]=m*x+n*C+u*G;i[4]=b*A+r*E+p*y;i[5]=j*A+q*E+s*y;i[6]=k*A+v*E+t*y;i[7]=m*A+n*E+u*y;i[8]=b*F+r*d+p*e;i[9]=j*F+q*d+s*e;i[10]=k*F+v*d+t*e;i[11]=m*F+n*d+u*e;return i},rotateX:function(a,b,c){var i=Math.sin(b),b=Math.cos(b),d=a[4],e=a[5],j=a[6],f=a[7],g=a[8],l=a[9],k=a[10],m=a[11];c?a!==c&&(c[0]=
a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=d*b+g*i;c[5]=e*b+l*i;c[6]=j*b+k*i;c[7]=f*b+m*i;c[8]=d*-i+g*b;c[9]=e*-i+l*b;c[10]=j*-i+k*b;c[11]=f*-i+m*b;return c},rotateY:function(a,b,c){var i=Math.sin(b),b=Math.cos(b),d=a[0],e=a[1],j=a[2],f=a[3],g=a[8],l=a[9],k=a[10],m=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=d*b+g*-i;c[1]=e*b+l*-i;c[2]=j*b+k*-i;c[3]=f*b+m*-i;c[8]=d*i+g*b;c[9]=e*
i+l*b;c[10]=j*i+k*b;c[11]=f*i+m*b;return c},rotateZ:function(a,b,c){var i=Math.sin(b),b=Math.cos(b),d=a[0],e=a[1],j=a[2],f=a[3],g=a[4],l=a[5],k=a[6],m=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=d*b+g*i;c[1]=e*b+l*i;c[2]=j*b+k*i;c[3]=f*b+m*i;c[4]=d*-i+g*b;c[5]=e*-i+l*b;c[6]=j*-i+k*b;c[7]=f*-i+m*b;return c},frustum:function(a,b,c,i,d,e,j){j||(j=q.create());var f=b-a,g=i-c,l=e-d;j[0]=2*d/f;j[1]=0;j[2]=0;j[3]=0;j[4]=0;j[5]=2*d/
g;j[6]=0;j[7]=0;j[8]=(b+a)/f;j[9]=(i+c)/g;j[10]=-(e+d)/l;j[11]=-1;j[12]=0;j[13]=0;j[14]=-(2*e*d)/l;j[15]=0;return j},perspective:function(a,b,c,i,d){a=c*Math.tan(a*Math.PI/360);b*=a;return q.frustum(-b,b,-a,a,c,i,d)},ortho:function(a,b,c,i,d,e,j){j||(j=q.create());var f=b-a,g=i-c,l=e-d;j[0]=2/f;j[1]=0;j[2]=0;j[3]=0;j[4]=0;j[5]=2/g;j[6]=0;j[7]=0;j[8]=0;j[9]=0;j[10]=-2/l;j[11]=0;j[12]=-(a+b)/f;j[13]=-(i+c)/g;j[14]=-(e+d)/l;j[15]=1;return j},lookAt:function(a,b,c,d){d||(d=q.create());var e,f,j,g,l,k,
m,r,v=a[0],n=a[1],a=a[2];j=c[0];g=c[1];f=c[2];m=b[0];c=b[1];e=b[2];if(v===m&&n===c&&a===e)return q.identity(d);b=v-m;c=n-c;m=a-e;r=1/Math.sqrt(b*b+c*c+m*m);b*=r;c*=r;m*=r;e=g*m-f*c;f=f*b-j*m;j=j*c-g*b;(r=Math.sqrt(e*e+f*f+j*j))?(r=1/r,e*=r,f*=r,j*=r):j=f=e=0;g=c*j-m*f;l=m*e-b*j;k=b*f-c*e;(r=Math.sqrt(g*g+l*l+k*k))?(r=1/r,g*=r,l*=r,k*=r):k=l=g=0;d[0]=e;d[1]=g;d[2]=b;d[3]=0;d[4]=f;d[5]=l;d[6]=c;d[7]=0;d[8]=j;d[9]=k;d[10]=m;d[11]=0;d[12]=-(e*v+f*n+j*a);d[13]=-(g*v+l*n+k*a);d[14]=-(b*v+c*n+m*a);d[15]=
1;return d},fromRotationTranslation:function(a,b,c){c||(c=q.create());var d=a[0],e=a[1],f=a[2],j=a[3],g=d+d,l=e+e,k=f+f,a=d*g,m=d*l,d=d*k,r=e*l,e=e*k,f=f*k,g=j*g,l=j*l,j=j*k;c[0]=1-(r+f);c[1]=m+j;c[2]=d-l;c[3]=0;c[4]=m-j;c[5]=1-(a+f);c[6]=e+g;c[7]=0;c[8]=d+l;c[9]=e-g;c[10]=1-(a+r);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+
", "+a[14]+", "+a[15]+"]"}},k={create:function(a){var b=new p(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new p(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},identity:function(a){a||(a=k.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},
E=k.identity();k.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a;b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};k.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};k.inverse=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],c=(c=c*c+d*d+e*e+f*f)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};k.conjugate=function(a,b){if(!b||
a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};k.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};k.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],j=Math.sqrt(c*c+d*d+e*e+f*f);if(0===j)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;j=1/j;b[0]=c*j;b[1]=d*j;b[2]=e*j;b[3]=f*j;return b};k.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+
b[2];c[3]=a[3]+b[3];return c};k.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],j=b[0],g=b[1],l=b[2],b=b[3];c[0]=d*b+a*j+e*l-f*g;c[1]=e*b+a*g+f*j-d*l;c[2]=f*b+a*l+d*g-e*j;c[3]=a*b-d*j-e*g-f*l;return c};k.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],b=a[0],j=a[1],g=a[2],a=a[3],l=a*d+j*f-g*e,k=a*e+g*d-b*f,m=a*f+b*e-j*d,d=-b*d-j*e-g*f;c[0]=l*a+d*-b+k*-g-m*-j;c[1]=k*a+d*-j+m*-b-l*-g;c[2]=m*a+d*-g+l*-j-k*-b;return c};k.scale=function(a,b,c){if(!c||a===c)return a[0]*=
b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};k.toMat3=function(a,b){b||(b=s.create());var c=a[0],d=a[1],e=a[2],f=a[3],j=c+c,g=d+d,l=e+e,k=c*j,m=c*g,c=c*l,r=d*g,d=d*l,e=e*l,j=f*j,g=f*g,f=f*l;b[0]=1-(r+e);b[1]=m+f;b[2]=c-g;b[3]=m-f;b[4]=1-(k+e);b[5]=d+j;b[6]=c+g;b[7]=d-j;b[8]=1-(k+r);return b};k.toMat4=function(a,b){b||(b=q.create());var c=a[0],d=a[1],e=a[2],f=a[3],j=c+c,g=d+d,l=e+e,k=c*j,m=c*g,c=c*l,r=d*g,d=d*l,e=e*l,j=f*j,g=f*g,f=f*l;b[0]=1-(r+e);b[1]=m+f;
b[2]=c-g;b[3]=0;b[4]=m-f;b[5]=1-(k+e);b[6]=d+j;b[7]=0;b[8]=c+g;b[9]=d-j;b[10]=1-(k+r);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};k.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],f,j;if(1<=Math.abs(e))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;f=Math.acos(e);j=Math.sqrt(1-e*e);if(0.0010>Math.abs(j))return d[0]=0.5*a[0]+0.5*b[0],d[1]=0.5*a[1]+0.5*b[1],d[2]=0.5*a[2]+0.5*b[2],d[3]=0.5*a[3]+0.5*b[3],d;e=Math.sin((1-c)*f)/j;c=Math.sin(c*f)/j;d[0]=a[0]*
e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};k.fromRotationMatrix=function(a,b){b||(b=k.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=0.5*d,d=0.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=k.fromRotationMatrix.s_iNext=k.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var e=d[c],f=d[e];d=Math.sqrt(a[3*c+c]-a[3*e+e]-a[3*f+f]+1);b[c]=0.5*d;d=0.5/d;b[3]=(a[3*f+e]-a[3*e+f])*d;b[e]=(a[3*e+c]+a[3*c+e])*d;
b[f]=(a[3*f+c]+a[3*c+f])*d}return b};s.toQuat4=k.fromRotationMatrix;var t=s.create();k.fromAxes=function(a,b,c,d){t[0]=b[0];t[3]=b[1];t[6]=b[2];t[1]=c[0];t[4]=c[1];t[7]=c[2];t[2]=a[0];t[5]=a[1];t[8]=a[2];return k.fromRotationMatrix(t,d)};k.identity=function(a){a||(a=k.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};k.fromAngleAxis=function(a,b,c){c||(c=k.create());var a=0.5*a,d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};k.toAngleAxis=function(a,b){b||(b=a);var c=a[0]*
a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=g.invsqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};k.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var C={create:function(a){var b=new p(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},createFrom:function(a,b){var c=new p(2);c[0]=a;c[1]=b;return c},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];
return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,
b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)},squaredLength:function(a){var b=a[0],a=a[1];return b*b+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],a=a[1]-b[1],b=d*d+a*a;if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=
a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}},F={create:function(a){var b=new p(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,d){var e=new p(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>
Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},identity:function(a){a||(a=F.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b){var c=a[1];a[1]=a[2];a[2]=c;return a}b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],j=c*f-e*d;if(!j)return null;j=1/j;b[0]=f*j;b[1]=-d*j;b[2]=-e*j;b[3]=c*j;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],
a=a[3];c[0]=d*b[0]+e*b[2];c[1]=d*b[1]+e*b[3];c[2]=f*b[0]+a*b[2];c[3]=f*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],a=a[3],j=Math.sin(b),b=Math.cos(b);c[0]=d*b+e*j;c[1]=d*-j+e*b;c[2]=f*b+a*j;c[3]=f*-j+a*b;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0],b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],e=a[2],f=a[3],j=b[0],b=b[1];c[0]=a[0]*j;c[1]=d*b;c[2]=e*j;c[3]=f*b;return c},str:function(a){return"["+a[0]+
", "+a[1]+", "+a[2]+", "+a[3]+"]"}},A={create:function(a){var b=new p(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},createFrom:function(a,b,c,d){var e=new p(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*
b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},equal:function(a,b){return a===b||1E-6>Math.abs(a[0]-b[0])&&1E-6>Math.abs(a[1]-b[1])&&1E-6>Math.abs(a[2]-b[2])&&1E-6>Math.abs(a[3]-b[3])},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];
b[3]=-a[3];return b},length:function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)},squaredLength:function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return b*b+c*c+d*d+a*a},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};d&&(d.glMatrixArrayType=p,d.MatrixArray=p,d.setMatrixArrayType=e,d.determineMatrixArrayType=f,d.glMath=g,d.vec2=
C,d.vec3=l,d.vec4=A,d.mat2=F,d.mat3=s,d.mat4=q,d.quat4=k);return{glMatrixArrayType:p,MatrixArray:p,setMatrixArrayType:e,determineMatrixArrayType:f,glMath:g,vec2:C,vec3:l,vec4:A,mat2:F,mat3:s,mat4:q,quat4:k}});
(function(){function d(d){d||(d=Math.random);this.p=new Uint8Array(256);this.perm=new Uint8Array(512);this.permMod12=new Uint8Array(512);for(var e=0;256>e;e++)this.p[e]=256*d();for(e=0;512>e;e++)this.perm[e]=this.p[e&255],this.permMod12[e]=this.perm[e]%12}var e=0.5*(Math.sqrt(3)-1),f=(3-Math.sqrt(3))/6,g=1/3,n=1/6,y=(Math.sqrt(5)-1)/4,p=(5-Math.sqrt(5))/20;d.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,
1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(d,g){var m=this.permMod12,n=this.perm,v=this.grad3,p=0,u=0,s=0,q=(d+g)*e,k=Math.floor(d+q),E=Math.floor(g+q),q=(k+E)*f,t=d-(k-q),C=g-(E-q),y,A;t>C?(y=1,A=0):(y=0,A=1);var a=t-y+f,b=
C-A+f,q=t-1+2*f,c=C-1+2*f,k=k&255,E=E&255,i=0.5-t*t-C*C;0<=i&&(p=3*m[k+n[E]],i*=i,p=i*i*(v[p]*t+v[p+1]*C));t=0.5-a*a-b*b;0<=t&&(u=3*m[k+y+n[E+A]],t*=t,u=t*t*(v[u]*a+v[u+1]*b));a=0.5-q*q-c*c;0<=a&&(m=3*m[k+1+n[E+1]],a*=a,s=a*a*(v[m]*q+v[m+1]*c));return 70*(p+u+s)},noise3D:function(d,e,f){var p=this.permMod12,v=this.perm,x=this.grad3,u,s,q=(d+e+f)*g,k=Math.floor(d+q),y=Math.floor(e+q),t=Math.floor(f+q),q=(k+y+t)*n;u=d-(k-q);var C=e-(y-q),F=f-(t-q),A,a,b,c,i,B;u>=C?C>=F?(A=1,b=a=0,i=c=1,B=0):(u>=F?(A=
1,b=a=0):(a=A=0,b=1),c=1,i=0,B=1):C<F?(a=A=0,b=1,c=0,B=i=1):u<F?(A=0,a=1,c=b=0,B=i=1):(A=0,a=1,b=0,i=c=1,B=0);s=u-A+n;var D=C-a+n,j=F-b+n,d=u-c+2*n,K=C-i+2*n,L=F-B+2*n,f=u-1+3*n,e=C-1+3*n,q=F-1+3*n,k=k&255,y=y&255,t=t&255,z=0.6-u*u-C*C-F*F;if(0>z)u=0;else{var J=3*p[k+v[y+v[t]]],z=z*z;u=z*z*(x[J]*u+x[J+1]*C+x[J+2]*F)}C=0.6-s*s-D*D-j*j;0>C?s=0:(A=3*p[k+A+v[y+a+v[t+b]]],C*=C,s=C*C*(x[A]*s+x[A+1]*D+x[A+2]*j));D=0.6-d*d-K*K-L*L;0>D?d=0:(c=3*p[k+c+v[y+i+v[t+B]]],D*=D,d=D*D*(x[c]*d+x[c+1]*K+x[c+2]*L));K=
0.6-f*f-e*e-q*q;0>K?x=0:(p=3*p[k+1+v[y+1+v[t+1]]],K*=K,x=K*K*(x[p]*f+x[p+1]*e+x[p+2]*q));return 32*(u+s+d+x)},noise4D:function(d,e,f,g){var n=this.perm,x=this.grad4,u,s,q,k=(d+e+f+g)*y,E=Math.floor(d+k),t=Math.floor(e+k),C=Math.floor(f+k),F=Math.floor(g+k),k=(E+t+C+F)*p;u=d-(E-k);s=e-(t-k);var A=f-(C-k),a=g-(F-k),g=f=k=e=0;u>s?e++:k++;u>A?e++:f++;u>a?e++:g++;s>A?k++:f++;s>a?k++:g++;A>a?f++:g++;var b,c,i,B,D,j,K,L,z,J;b=3<=e?1:0;c=3<=k?1:0;i=3<=f?1:0;B=3<=g?1:0;q=2<=e?1:0;D=2<=k?1:0;j=2<=f?1:0;K=2<=
g?1:0;d=1<=e?1:0;L=1<=k?1:0;z=1<=f?1:0;J=1<=g?1:0;var P=u-b+p,Q=s-c+p,R=A-i+p,H=a-B+p,S=u-q+2*p,T=s-D+2*p,U=A-j+2*p,V=a-K+2*p,W=u-d+3*p,X=s-L+3*p,Y=A-z+3*p,Z=a-J+3*p,g=u-1+4*p,f=s-1+4*p,k=A-1+4*p,e=a-1+4*p,E=E&255,t=t&255,C=C&255,F=F&255,M=0.6-u*u-s*s-A*A-a*a;if(0>M)u=0;else{var O=4*(n[E+n[t+n[C+n[F]]]]%32),M=M*M;u=M*M*(x[O]*u+x[O+1]*s+x[O+2]*A+x[O+3]*a)}s=0.6-P*P-Q*Q-R*R-H*H;0>s?s=0:(A=4*(n[E+b+n[t+c+n[C+i+n[F+B]]]]%32),s*=s,s=s*s*(x[A]*P+x[A+1]*Q+x[A+2]*R+x[A+3]*H));A=0.6-S*S-T*T-U*U-V*V;0>A?q=
0:(q=4*(n[E+q+n[t+D+n[C+j+n[F+K]]]]%32),A*=A,q=A*A*(x[q]*S+x[q+1]*T+x[q+2]*U+x[q+3]*V));D=0.6-W*W-X*X-Y*Y-Z*Z;0>D?d=0:(d=4*(n[E+d+n[t+L+n[C+z+n[F+J]]]]%32),D*=D,d=D*D*(x[d]*W+x[d+1]*X+x[d+2]*Y+x[d+3]*Z));L=0.6-g*g-f*f-k*k-e*e;0>L?x=0:(n=4*(n[E+1+n[t+1+n[C+1+n[F+1]]]]%32),L*=L,x=L*L*(x[n]*g+x[n+1]*f+x[n+2]*k+x[n+3]*e));return 27*(u+s+q+d+x)}};"undefined"!==typeof define&&define.amd?define(function(){return d}):"undefined"!==typeof window&&(window.SimplexNoise=d);"undefined"!==typeof exports&&(exports.SimplexNoise=
d);"undefined"!==typeof module&&(module.exports=d)})();var pressedKeys={},specialKeys={32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},lastMouse,curMouse;document.addEventListener("keydown",function(d){setKey(d,!0)});document.addEventListener("keyup",function(d){setKey(d,!1)});var down=!1,accessed=!1;document.addEventListener("mousedown",function(d){down=!0;lastMouse=[d.pageX,d.pageY];curMouse=[d.pageX,d.pageY]});
document.addEventListener("mousemove",function(d){curMouse||(lastMouse=[d.pageX,d.pageY],curMouse=[d.pageX,d.pageY]);down&&(lastMouse=curMouse,curMouse=[d.pageX,d.pageY],accessed=!1)});document.addEventListener("mouseup",function(){down=!1});function setKey(d,e){var f=d.keyCode;f in specialKeys?pressedKeys[specialKeys[f]]=e:pressedKeys[String.fromCharCode(f)]=e}function isDown(d){return pressedKeys[d.toUpperCase()]}function isMouseDown(){return down}
function getMouseMoved(){return curMouse&&!accessed?(accessed=!0,[curMouse[0]-lastMouse[0],curMouse[1]-lastMouse[1]]):[0,0]}function Resources(){this.resourceCache=Array(1E3);this.readyCallbacks=[]}Resources.prototype.load=function(d){var d=arguments[0],e=Array.prototype.slice.call(arguments);if(void 0===this.resourceCache[d]){var f=d.match(/\.([^\.]*)$/)[1];this.resourceCache[d]=!1;("mesh"==f?this.loadMesh:this.loadImage).apply(this,e)}};
Resources.prototype.onLoaded=function(d,e){this.resourceCache[d]=e;this.isReady()&&(this.readyCallbacks.forEach(function(d){d()}),this.readyCallbacks=[])};Resources.prototype.onFailure=function(d){console.log("failed to load resource: "+d)};Resources.prototype.loadMesh=function(d,e){var f=new XMLHttpRequest,g=this;f.onload=function(){if(200===f.status||0===f.status){var n=decompressSimpleMesh(f.responseText,e);g.onLoaded(d,n)}};f.onerror=function(){g.onFailure(d)};f.open("GET",d,!0);f.send(null)};
Resources.prototype.loadImage=function(d){var e=new Image,f=this;e.onload=function(){f.onLoaded(d,e)};e.onerror=function(){f.onFailure(d)};e.src=d};Resources.prototype.get=function(d){return this.resourceCache[d]};Resources.prototype.isReady=function(){var d=!0,e;for(e in this.resourceCache)this.resourceCache[e]||(d=!1);return d};Resources.prototype.onReady=function(d){this.isReady()?d():this.readyCallbacks.push(d)};var noise=new SimplexNoise(Math.random);
function Terrain(d,e,f,g){this.x=d;this.y=e;this.sizeX=f;this.sizeY=g;this.children=[];this.transform=mat4.create();mat4.identity(this.transform);d=mat4.create();mat4.identity(d);mat4.translate(d,[this.x,0,this.y],this.transform);createProgram("terrain",getShader("vertex-shader"),getShader("fragment-shader"));for(e=d=0;e<g;){for(var n=Math.min(g-e,256),d=0;d<f;){var y=Math.min(f-d,256);this.children.push(new TerrainChunk(d-Math.floor(d/256),e-Math.floor(e/256),y,n));d+=y}e+=n}}
Terrain.prototype.create=function(){this.children.forEach(function(d){d.create()})};Terrain.prototype.render=function(){};Terrain.getHeight=function(d,e,f){var g=15*noise.noise2D(d/128,e/128);f||(g+=noise.noise2D(d/8,e/8));return g};
function TerrainChunk(d,e,f,g){if(f*g>Math.pow(2,16))throw Error("terrain is too large, x*y must be less than 2^16");this.x=d;this.y=e;this.sizeX=f;this.sizeY=g;this.program=getProgram("terrain");this.transform=mat4.create();mat4.identity();d=mat4.create();mat4.identity(d);mat4.translate(d,[this.x,0,this.y],this.transform)}
TerrainChunk.prototype.create=function(){var d=this.sizeX,e=this.sizeY;this.vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);for(var f=new Float32Array(3*d*e),g=0;g<e;g++)for(var n=0;n<d;n++){var y=3*(g*d+n),p=this.x+n,l=this.y+g;f[y]=n;f[y+1]=Terrain.getHeight(p,l);f[y+2]=g}gl.bufferData(gl.ARRAY_BUFFER,f,gl.STATIC_DRAW);this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f=new Uint16Array(6*(d-1)*(e-1));for(g=p=0;g<e-1;g++)for(n=
0;n<d-1;n++)l=g*d+n,y=6*(g*(d-1)+n),f[y]=l,f[y+1]=l+1,f[y+2]=l+d,f[y+3]=l+d,f[y+4]=l+1,f[y+5]=l+d+1,l+d+1>p&&(p=l+d+1);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,f,gl.STATIC_DRAW);this.tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.tex);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,resources.get("resources/grass.jpg"));gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,
gl.NEAREST);this.texBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.texBuffer);f=new Float32Array(2*d*e);for(g=0;g<e;g++)for(n=0;n<d;n++)y=2*(g*d+n),f[y]=2*(n/d),f[y+1]=2*(g/e);gl.bufferData(gl.ARRAY_BUFFER,f,gl.STATIC_DRAW)};
TerrainChunk.prototype.render=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);var d=gl.getAttribLocation(this.program,"a_position");-1!=d&&(gl.enableVertexAttribArray(d),gl.vertexAttribPointer(d,3,gl.FLOAT,!1,0,0));gl.bindBuffer(gl.ARRAY_BUFFER,this.texBuffer);d=gl.getAttribLocation(this.program,"a_texcoord");-1!=d&&(gl.enableVertexAttribArray(d),gl.vertexAttribPointer(d,2,gl.FLOAT,!1,0,0));gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.tex);d=gl.getUniformLocation(this.program,
"sampler");-1!=!d&&gl.uniform1i(d,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.drawElements(gl.TRIANGLES,6*(this.sizeX-1)*(this.sizeY-1),gl.UNSIGNED_SHORT,0)};function Camera(d){this.pos=d;this.yaw=this.pitch=0}
Camera.prototype.update=function(d){this.transform=mat4.create();mat4.identity(this.transform);var e=getMouseMoved();this.pitch+=0.5*e[0]*d;this.yaw+=0.5*e[1]*d;if((isDown("LEFT")||isDown("a"))&&!isMouseDown())this.pitch-=1*d;if((isDown("RIGHT")||isDown("d"))&&!isMouseDown())this.pitch+=1*d;mat4.rotate(this.transform,Math.PI,[0,1,0]);mat4.rotate(this.transform,-this.yaw,[1,0,0]);mat4.rotate(this.transform,this.pitch,[0,1,0]);var e=vec3.create(),f=vec3.create();mat4.multiplyVec3(this.transform,[0,
0,-1],e);mat4.multiplyVec3(this.transform,[1,0,0],f);vec3.scale(e,180*d,e);vec3.scale(f,100*d,f);e[0]=-e[0];f[2]=-f[2];if((isDown("LEFT")||isDown("a"))&&isMouseDown())d=vec3.create(),vec3.subtract(this.pos,f,d),this.pos=d;if((isDown("RIGHT")||isDown("d"))&&isMouseDown())d=vec3.create(),vec3.add(this.pos,f,d),this.pos=d;if(isDown("UP")||isDown("w"))d=vec3.create(),vec3.add(this.pos,e,d),this.pos=d;if(isDown("DOWN")||isDown("s"))d=vec3.create(),vec3.subtract(this.pos,e,d),this.pos=d;isDown("SPACE")&&
renderer.addObject(new Ball);this.pos[1]=Terrain.getHeight(this.pos[0],this.pos[2],!0)+20;mat4.translate(this.transform,[-this.pos[0],-this.pos[1],-this.pos[2]])};var shaders={},programs={};
function _loadShader(d){var e=document.getElementById(d);if(!e)return null;var f=e.text;if("x-shader/x-vertex"==e.type)e=gl.VERTEX_SHADER;else if("x-shader/x-fragment"==e.type)e=gl.FRAGMENT_SHADER;else throw Error("unknown shader type: "+d);e=gl.createShader(e);gl.shaderSource(e,f);gl.compileShader(e);if(!gl.getShaderParameter(e,gl.COMPILE_STATUS))throw f=gl.getShaderInfoLog(e),gl.deleteShader(e),Error("shader compilation error ("+d+"): "+f);return shaders[d]=e}
function getShader(d){shaders[d]||_loadShader(d);return shaders[d]}function createProgram(d,e,f){var g=gl.createProgram();gl.attachShader(g,e);gl.attachShader(g,f);gl.linkProgram(g);if(!gl.getProgramParameter(g,gl.LINK_STATUS))throw d=gl.getProgramInfoLog(g),gl.deleteProgram(g),Error("program linking error: "+d);return programs[d]=g}function getProgram(d){return programs[d]}function iterPrograms(d){for(var e in programs)d(programs[e])}
function Renderer(d){this.objects=[];this.camera=d;this.mat4=mat4.create()}Renderer.prototype.init=function(){this.defaultProgram=createProgram("default",getShader("default-vertex"),getShader("default-fragment"))};Renderer.prototype.addObject=function(d){this.objects.push(d)};Renderer.prototype.update=function(d){this.camera.update(d);this.objects.forEach(function(e){e.update&&e.update(d)},this)};
Renderer.prototype.render=function(){this.objects.forEach(function(d){mat4.set(this.camera.transform,this.mat4);this.renderObject(d)},this)};Renderer.prototype.renderObject=function(d){var e=this.mat4,f=mat4.create();d.program||(d.program=this.defaultProgram);gl.useProgram(d.program);mat4.multiply(e,d.transform,f);gl.uniformMatrix4fv(gl.getUniformLocation(d.program,"transform"),!1,f);d.render();d.children&&d.children.forEach(function(d){this.renderObject(d)},this);this.mat4=e};"use strict";
function decompressInner_(d,e,f,g,n,y,p,l){for(var r=0;e<f;e++){var m=d.charCodeAt(e),r=r+(m>>1^-(m&1));g[n]=l*(r+p);n+=y}}
function decompressSimpleMesh(d,e){var f=d.charCodeAt(0);57344<=f&&(f-=2048);f++;for(var g=e[0].stride,n=new Float32Array(g),y=new Float32Array(g),p=e.length,l=0;l<p;l++)for(var r=e[l],m=r.offset+r.size,G=r.offset;G<m;G++)n[G]=r.decodeOffset,y[G]=r.decodeScale;p=1;r=new Float32Array(g*f);for(l=0;l<g;l++)m=p+f,(G=y[l])&&decompressInner_(d,p,m,r,l,g,n[l],G),p=m;f=d.length-p;g=new Uint16Array(f);for(l=n=0;l<f;l++)y=d.charCodeAt(l+p),g[l]=n-y,0==y&&n++;return[r,g]}
function meshBufferData(d,e){var f=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,f);d.bufferData(d.ARRAY_BUFFER,e[0],d.STATIC_DRAW);var g=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,g);d.bufferData(d.ELEMENT_ARRAY_BUFFER,e[1],d.STATIC_DRAW);return[f,g]}
var Stats=function(){var d=Date.now(),e=d,f=0,g=Infinity,n=0,y=0,p=Infinity,l=0,r=0,m=0,G=document.createElement("div");G.id="stats";G.addEventListener("mousedown",function(d){d.preventDefault();t(++m%2)},!1);G.style.cssText="width:80px;opacity:0.9;cursor:pointer";var v=document.createElement("div");v.id="fps";v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";G.appendChild(v);var x=document.createElement("div");x.id="fpsText";x.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";
x.innerHTML="FPS";v.appendChild(x);var u=document.createElement("div");u.id="fpsGraph";u.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(v.appendChild(u);74>u.children.length;){var s=document.createElement("span");s.style.cssText="width:1px;height:30px;float:left;background-color:#113";u.appendChild(s)}var q=document.createElement("div");q.id="ms";q.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";G.appendChild(q);var k=document.createElement("div");
k.id="msText";k.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";k.innerHTML="MS";q.appendChild(k);var E=document.createElement("div");E.id="msGraph";E.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(q.appendChild(E);74>E.children.length;)s=document.createElement("span"),s.style.cssText="width:1px;height:30px;float:left;background-color:#131",E.appendChild(s);var t=function(d){m=d;switch(m){case 0:v.style.display=
"block";q.style.display="none";break;case 1:v.style.display="none",q.style.display="block"}};return{REVISION:11,domElement:G,setMode:t,begin:function(){d=Date.now()},end:function(){var m=Date.now();f=m-d;g=Math.min(g,f);n=Math.max(n,f);k.textContent=f+" MS ("+g+"-"+n+")";var q=Math.min(30,30-30*(f/200));E.appendChild(E.firstChild).style.height=q+"px";r++;m>e+1E3&&(y=Math.round(1E3*r/(m-e)),p=Math.min(p,y),l=Math.max(l,y),x.textContent=y+" FPS ("+p+"-"+l+")",q=Math.min(30,30-30*(y/100)),u.appendChild(u.firstChild).style.height=
q+"px",e=m,r=0);return m},update:function(){d=this.end()}}},requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}(),resources=new Resources,stats,w=window.innerWidth,h=window.innerHeight,renderer,gl,canvas=document.getElementById("canvas");canvas.width=w;canvas.height=h;
var DEFAULT_ATTRIB_ARRAYS=[{name:"a_position",size:3,stride:8,offset:0,decodeOffset:-4095,decodeScale:1/8191},{name:"a_texcoord",size:2,stride:8,offset:3,decodeOffset:0,decodeScale:1/1023},{name:"a_normal",size:3,stride:8,offset:3,decodeOffset:-511,decodeScale:1/1023}];function convertToWireframe(d){for(var e=new Uint16Array(6*(d.length/3)),f=0,g=0;g<d.length;g+=3)e[f++]=d[g],e[f++]=d[g+1],e[f++]=d[g+1],e[f++]=d[g+2],e[f++]=d[g+2],e[f++]=d[g];return e}
function Mesh(d,e){this.pos=e;this.transform=mat4.create();this.url=d;this.attribDesc=DEFAULT_ATTRIB_ARRAYS;var f=mat4.create();mat4.identity(f);mat4.translate(f,e,this.transform);mat4.scale(this.transform,[60,60,60],this.transform)}
Mesh.prototype.create=function(d){var e=resources.get(this.url);this.attribBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.attribBuffer);gl.bufferData(gl.ARRAY_BUFFER,e[0],gl.STATIC_DRAW);this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);e=e[1];gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e,gl.STATIC_DRAW);this.numIndices=e.length;this.program=d;this.attribs={};for(var f=gl.getProgramParameter(d,gl.ACTIVE_ATTRIBUTES),e=0;e<f;e++){var g=gl.getActiveAttrib(d,
e);this.attribs[g.name]=gl.getAttribLocation(d,g.name)}this.uniforms={};f=gl.getProgramParameter(d,gl.ACTIVE_UNIFORMS);for(e=0;e<f;e++)g=gl.getActiveUniform(d,e),this.uniforms[g.name]=gl.getUniformLocation(d,g.name)};
Mesh.prototype.render=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.attribBuffer);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var d=0;d<this.attribDesc.length;d++){var e=this.attribDesc[d],f=this.attribs[e.name];void 0!==f&&(gl.enableVertexAttribArray(f),gl.vertexAttribPointer(f,e.size,gl.FLOAT,!!e.normalized,4*e.stride,4*e.offset))}gl.drawElements(gl.TRIANGLES,this.numIndices,gl.UNSIGNED_SHORT,0)};
function init(){gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");var d=mat4.create();mat4.perspective(45,w/h,0.1,1E3,d);renderer=new Renderer(new Camera([20,10,20]));renderer.init();var e=new Terrain(0,0,1280,1280);e.create();renderer.addObject(e);e=new Mesh("resources/ben.mesh",[0,20,0]);e.create(getProgram("terrain"));renderer.addObject(e);iterPrograms(function(e){gl.useProgram(e);e=gl.getUniformLocation(e,"pers");gl.uniformMatrix4fv(e,!1,d)});gl.enable(gl.DEPTH_TEST);heartbeat()}
var last=Date.now();function heartbeat(){stats.begin();var d=Date.now();renderer.update((d-last)/1E3);gl.clearColor(0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);renderer.render();stats.end();last=d;requestAnimFrame(heartbeat)}
window.addEventListener("load",function(){stats=new Stats;stats.setMode(1);stats.domElement.style.position="absolute";stats.domElement.style.right="0px";stats.domElement.style.top="0px";document.body.appendChild(stats.domElement);resources.load("resources/ben.mesh",DEFAULT_ATTRIB_ARRAYS);resources.load("resources/teapot.mesh",DEFAULT_ATTRIB_ARRAYS);resources.load("resources/grass.jpg");resources.onReady(init)});
